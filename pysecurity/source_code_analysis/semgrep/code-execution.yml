rules:
  - id: code-execution
    languages:
      - python
    message: Code execution found in setup.py, could potentially execute unwanted code.
    pattern-either:
      - patterns:
        - pattern-either:
            - pattern: execfile(...)
            - pattern: exec(...)
        - pattern-not-inside: | # Case of reading version from file
            with open(os.path.join(..., '__version__.py'), ...) as $F:
              ...
      - pattern: eval(...)
      - pattern: (...).getoutput(...)
      - pattern: getoutput(...)
      - pattern: (...).call(...)
      - pattern: call(...)
      - pattern: (...).Popen(...)
      - pattern: Popen(...)
      - pattern: (...).popen(...)
      - pattern: popen(...)
    paths:
      include:
        - "*/setup.py"
        - semgrep_tests/code-execution.py # Need to run on test file
    severity: WARNING

